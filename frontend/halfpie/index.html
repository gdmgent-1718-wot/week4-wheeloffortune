<!DOCTYPE html>
<html >
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Win up to 100 euro! | By Basiel Smitz & Adriaan Glibert</title>
  <link rel='stylesheet prefetch' href='https://cdnjs.cloudflare.com/ajax/libs/chartist/0.11.0/chartist.min.css'>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/loading.css">
  <link rel="stylesheet" href="css/simple-grid.min.css">
</head>
<body>

<!--This is the loading screen-->
  <div id="loading-wrapper" style="display: none ">
    <div id="loading-text">SPINNING</div>
    <div id="loading-content"></div>
  </div>
<!--This contains the wheel, button and winningtext-->
    <div id="wheelOfFortune">
      <h1>Press the button and win up to 100 euro!</h1>
      <button class="btn" v-on:click="letsGo">LET'S GO</button>
      <div class = 'ct-pie'></div>
      <h2 style="display: none" id="prize">You have won <span>{{prizemoney}}</span></h2>
    </div>
<!--We added Vue code-->
  <script src="https://cdn.jsdelivr.net/npm/vue"></script>
  <script>
      new Vue({
          el: '#wheelOfFortune',
          data: {
              prizemoney: '...'
          },
          methods: {
//              This method is fired when you press the LETS GO button.
              letsGo() {
//              We make sure the winning text is hidden, and let the wheel fadeOut to bring on the loading screen.
                  $('#prize').hide()
                  $('#wheelOfFortune').fadeOut()
                  $('#loading-wrapper').fadeIn()
//              We reset the styling that shows which piece was selected the previous turn.
                  $('.ct-series').css({"stroke": "white", "stroke-width": "0px"})

//              Select a totally random piece.
                  let randomPiece = data.moreInfo[Math.floor(Math.random() * data.moreInfo.length)]
//              Update the winning text.
                  this.prizemoney = data.labels[randomPiece.index]

//              Update the style of the piece that was selected, but only after 4 seconds.
                  function updateStyle() {
                      let classSelectedPiece = randomPiece.class
                      $(classSelectedPiece).css({"stroke": "white", "stroke-width": "5px"})

                      // Make the loading screen go away and show the wheel and winning text.
                      $('#loading-wrapper').fadeOut()
                      $('#wheelOfFortune').fadeIn()
                      $('#prize').fadeIn()
                  }
                  setTimeout(updateStyle, 6000);

//              Initialize firebase database.
                  let database = firebase.database()

//              Send "false" to the database so the wheel starts spinning.
                  database.ref('value').set({
                      value: randomPiece.dutyCycle,
                      picked: false
                  });

//              Send the randomPiece to the database after 74 seconds and set picked true so it stops spinning.
                  function sendData(){
                      database.ref('value').set({
                          value: randomPiece.dutyCycle,
                          picked: true
                      });
                  }
                  setTimeout(sendData, 4000);
              }
          }
      })
  </script>


    <script src='https://code.jquery.com/jquery-3.2.1.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/chartist/0.11.0/chartist.js'></script>
    <script  src="js/index.js"></script>

    <!--Laad Firebase-->
    <script src="https://www.gstatic.com/firebasejs/4.5.2/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyAu-Z4xVVJvw5V9gilhQc0ykrfrjRhXtRI",
            authDomain: "wheeloffortune-18d6d.firebaseapp.com",
            databaseURL: "https://wheeloffortune-18d6d.firebaseio.com",
            projectId: "wheeloffortune-18d6d",
            storageBucket: "",
            messagingSenderId: "974256373838"
        };
        firebase.initializeApp(config);
    </script>

</body>
</html>
